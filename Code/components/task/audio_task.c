/*
 * led_driver.c
 *
 *  Created on: Jan 9, 2021
 *      Author: ductu
 */
/***********************************************************************************************************************
 * Pragma directive
 ***********************************************************************************************************************/

/***********************************************************************************************************************
 * Includes <System Includes>
 ***********************************************************************************************************************/
#include "audio_task.h"
#include "../user_driver/leds/user_leds.h"
/***********************************************************************************************************************
 * Macro definitions
 ***********************************************************************************************************************/

/***********************************************************************************************************************
 * Typedef definitions
 ***********************************************************************************************************************/

/***********************************************************************************************************************
 * Private global variables and functions
 ***********************************************************************************************************************/
static void AudioControl_Task(void *pvParameters);
static bool audio_active = false;
/***********************************************************************************************************************
 * Exported global variables and functions (to be accessed by other files)
 ***********************************************************************************************************************/
static E_PLAY_AUDIO_TYPE audio_type = kWakeUpAudio;
/***********************************************************************************************************************
 * Imported global variables and functions (from other files)
 ***********************************************************************************************************************/

/***********************************************************************************************************************
 * Function Name:
 * Description  : initialize peripheral
 * Arguments    : none
 * Return Value : none
 ***********************************************************************************************************************/
void audio_task(void)
{
    xTaskCreatePinnedToCore(AudioControl_Task, "audio_task", 4 * 1024, NULL, 2 | portPRIVILEGE_BIT, NULL, 0);
}
/***********************************************************************************************************************
 * Static Functions
 ***********************************************************************************************************************/
void audio_task_activate_callback(E_PLAY_AUDIO_TYPE _type,
                                  e_MODE_SELECTOR _mode,
                                  e_LANGUAGE_SELECTOR _language,
                                  e_PAGE_NUMBER _page_number,
                                  e_TOUCH_NUMBER _touch_number)
{
    audio_active = true;
    audio_type = _type;
}

/***********************************************************************************************************************
 * Function Name:
 * Description  :
 * Arguments    :
 * Return Value : none
 ***********************************************************************************************************************/
static void AudioControl_Task(void *pvParameters)
{
    while (1)
    {
        if (audio_active == true)
        {
            play_audio_call_back(audio_type, device_data.mode, device_data.languge, device_data.page_number, device_data.touch_number);
            audio_active = false;
            user_leds_call(kLED_OFF, 0);
        }
        vTaskDelay(100 / portTICK_PERIOD_MS);
    }
}
/***********************************************************************************************************************
 * End of file
 ***********************************************************************************************************************/
